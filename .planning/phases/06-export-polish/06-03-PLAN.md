---
phase: 06-export-polish
plan: 03
type: execute
wave: 2
depends_on: ["06-01", "06-02"]
files_modified:
  - package.json
  - src/test/setup.ts
  - src/components/results/ResultsSection.test.tsx
  - src/components/results/AdvancedResultsSection.test.tsx
  - src/components/results/VerdictCard.tsx
  - src/components/results/EVSIVerdictCard.tsx
  - src/components/results/SupportingCard.tsx
autonomous: true

must_haves:
  truths:
    - "vitest-axe is installed and configured"
    - "Results components have accessibility tests"
    - "Dynamic results have ARIA live regions for screen reader announcements"
    - "Color is never sole indicator of status (text redundancy exists)"
  artifacts:
    - path: "src/test/setup.ts"
      provides: "vitest-axe extend-expect import"
      contains: "vitest-axe"
    - path: "src/components/results/ResultsSection.test.tsx"
      provides: "Accessibility tests for Basic mode results"
      contains: "toHaveNoViolations"
    - path: "src/components/results/VerdictCard.tsx"
      provides: "ARIA live region for verdict"
      contains: "aria-live"
  key_links:
    - from: "src/test/setup.ts"
      to: "vitest-axe"
      via: "import"
      pattern: "vitest-axe/extend-expect"
---

<objective>
Add accessibility testing with vitest-axe and implement ARIA live regions for dynamic result updates.

Purpose: Satisfy UX-07 (color+text redundancy) and ensure WCAG 2.1 AA conformance per 06-CONTEXT.md. Add automated accessibility checks to catch regressions.

Output:
- vitest-axe installed and configured in test setup
- Accessibility tests for ResultsSection and AdvancedResultsSection
- ARIA live regions on verdict cards for screen reader announcements
- Text redundancy for any color-based status indicators
</objective>

<execution_context>
@/Users/ryan.lucht/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ryan.lucht/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06-export-polish/06-CONTEXT.md
@.planning/phases/06-export-polish/06-RESEARCH.md
@src/test/setup.ts
@src/components/results/VerdictCard.tsx
@src/components/results/SupportingCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install vitest-axe and configure test setup</name>
  <files>package.json, src/test/setup.ts</files>
  <action>
Install vitest-axe as dev dependency (version ^1.0.0-rc.3 per RESEARCH.md):
```bash
npm install --save-dev vitest-axe
```

Update src/test/setup.ts to:
1. Import and extend expect with vitest-axe matchers:
   ```typescript
   import 'vitest-axe/extend-expect';
   ```

This enables the `toHaveNoViolations()` matcher for axe-core accessibility checks.

Note per RESEARCH.md pitfall #2: Color contrast checks don't work reliably in jsdom.
Automated tests catch structural issues; color contrast verified manually.
  </action>
  <verify>npm install completes, npm test runs without import errors</verify>
  <done>vitest-axe installed and configured, toHaveNoViolations matcher available</done>
</task>

<task type="auto">
  <name>Task 2: Add ARIA live regions to verdict cards</name>
  <files>src/components/results/VerdictCard.tsx, src/components/results/EVSIVerdictCard.tsx</files>
  <action>
Add ARIA live regions for screen reader announcements when results update.

VerdictCard.tsx:
1. Add role="status" and aria-live="polite" to the verdict headline container
2. This announces the EVPI value when it changes/appears

EVSIVerdictCard.tsx:
1. Add role="status" and aria-live="polite" to the verdict headline container
2. Add aria-busy={isLoading} when loading state is active
3. Add screen-reader-only loading announcement

Pattern per RESEARCH.md:
```tsx
<div role="status" aria-live="polite" aria-busy={loading}>
  {loading ? (
    <span className="sr-only">Calculating result...</span>
  ) : (
    <span>{verdict content}</span>
  )}
</div>
```

Per RESEARCH.md pitfall #4: Live region must exist in DOM before content changes.
Render the container always, update content inside it.
  </action>
  <verify>npm run build passes, inspect elements have aria attributes</verify>
  <done>VerdictCard and EVSIVerdictCard have ARIA live regions for dynamic announcements</done>
</task>

<task type="auto">
  <name>Task 3: Create accessibility tests and verify text redundancy</name>
  <files>src/components/results/ResultsSection.test.tsx, src/components/results/AdvancedResultsSection.test.tsx, src/components/results/SupportingCard.tsx</files>
  <action>
Create accessibility test files using vitest-axe.

ResultsSection.test.tsx:
```typescript
import { render } from '@testing-library/react';
import { axe } from 'vitest-axe';
import { ResultsSection } from './ResultsSection';

// Mock useEVPICalculations to return sample data
// Mock useWizardStore for inputs

describe('ResultsSection accessibility', () => {
  it('has no accessibility violations', async () => {
    const { container } = render(<ResultsSection />);
    expect(await axe(container)).toHaveNoViolations();
  });
});
```

Similar test for AdvancedResultsSection.

SupportingCard.tsx - verify text redundancy:
1. Check the "highlight" variant - ensure color is NOT the sole indicator
2. The variant currently uses highlight styling - add text like "(notable)" or an icon
3. If highlight variant just changes background, ensure the description text provides context

Per UX-07 and WCAG 1.4.1: Color must not be the only means of conveying information.
SupportingCard highlight variant should have text or icon redundancy, not just color.

Review existing component: if highlight variant just adds bg-primary/10 without text indicator, add an sr-only label or visible indicator.
  </action>
  <verify>npm test passes including new accessibility tests, no axe violations</verify>
  <done>Accessibility tests created, text redundancy verified for color-based indicators</done>
</task>

</tasks>

<verification>
1. `npm install` completes without errors
2. `npm run build` passes (TypeScript compiles)
3. `npm test` passes including new accessibility tests
4. Accessibility tests use axe() and toHaveNoViolations()
5. VerdictCard has role="status" aria-live="polite"
6. EVSIVerdictCard has role="status" aria-live="polite" aria-busy
7. SupportingCard highlight variant has text/icon redundancy beyond color
</verification>

<success_criteria>
- vitest-axe installed and working in test suite
- ResultsSection and AdvancedResultsSection have passing axe tests
- ARIA live regions announce verdict updates to screen readers
- No color-only status indicators (text redundancy exists)
- All existing tests continue to pass
</success_criteria>

<output>
After completion, create `.planning/phases/06-export-polish/06-03-SUMMARY.md`
</output>
