---
phase: 06-export-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/export/ExportCard.tsx
  - src/components/export/ExportButton.tsx
  - src/hooks/useExportPng.ts
  - src/components/results/ResultsSection.tsx
  - src/components/results/AdvancedResultsSection.tsx
  - package.json
autonomous: true

must_haves:
  truths:
    - "User can export PNG of results with verdict, inputs, and mini chart"
    - "PNG is 1080x1080 square format"
    - "User can add custom title before export"
    - "Download triggers on button click"
  artifacts:
    - path: "src/components/export/ExportCard.tsx"
      provides: "Hidden render target for PNG capture"
      exports: ["ExportCard"]
    - path: "src/components/export/ExportButton.tsx"
      provides: "Export trigger with title input and loading state"
      exports: ["ExportButton"]
    - path: "src/hooks/useExportPng.ts"
      provides: "Hook wrapping html-to-image logic"
      exports: ["useExportPng"]
  key_links:
    - from: "src/components/export/ExportButton.tsx"
      to: "useExportPng"
      via: "hook call in click handler"
      pattern: "useExportPng"
    - from: "src/components/results/ResultsSection.tsx"
      to: "ExportButton"
      via: "component import and render"
      pattern: "<ExportButton"
---

<objective>
Implement PNG export functionality for results using html-to-image.

Purpose: Satisfy EXPORT-01 through EXPORT-04 â€” users can export a shareable PNG image card with verdict, key inputs summary, and mini distribution chart.

Output:
- ExportCard component (hidden render target with composed content)
- ExportButton component (trigger with title input)
- useExportPng hook (html-to-image wrapper)
- Integration into ResultsSection and AdvancedResultsSection
</objective>

<execution_context>
@/Users/ryan.lucht/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ryan.lucht/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-export-polish/06-CONTEXT.md
@.planning/phases/06-export-polish/06-RESEARCH.md
@src/components/results/ResultsSection.tsx
@src/components/results/AdvancedResultsSection.tsx
@src/components/charts/PriorDistributionChart.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install html-to-image and create useExportPng hook</name>
  <files>package.json, src/hooks/useExportPng.ts</files>
  <action>
Install html-to-image (version ^1.11.13 per RESEARCH.md).

Create useExportPng hook that:
1. Accepts a ref to the export target element
2. Provides exportPng(filename) async function
3. Uses toPng with options:
   - pixelRatio: 2 (retina/high DPI)
   - backgroundColor: '#FFFFFF'
   - width: 1080
   - height: 1080
4. Triggers download using native `<a download>` pattern (no file-saver needed)
5. Returns { exportRef, exportPng, isExporting } for loading state
6. Sanitizes filename: replace spaces with dashes, remove special chars

Filename convention per RESEARCH.md recommendations:
- If custom title provided: `{sanitized-title}-{timestamp}.png`
- Default: `should-i-test-{timestamp}.png`
- Timestamp format: YYYYMMDD-HHmmss
  </action>
  <verify>npm install completes, hook file exists and exports useExportPng</verify>
  <done>html-to-image installed, useExportPng hook implemented with ref, export function, and loading state</done>
</task>

<task type="auto">
  <name>Task 2: Create ExportCard hidden render target</name>
  <files>src/components/export/ExportCard.tsx</files>
  <action>
Create ExportCard component that renders the composed content for PNG export (NOT a screenshot of live UI).

Props:
- mode: 'basic' | 'advanced'
- title?: string (custom title from user, defaults to "Should I Test That?")
- verdict: string (formatted verdict text)
- verdictValue: number (EVPI or Net Value in dollars)
- prior: { meanPercent: number, lowPercent: number, highPercent: number }
- threshold: { scenario: string, valuePercent?: number, valueDollars?: number }
- miniChartData: PriorDistribution (for rendering mini chart)
- miniChartThreshold_L: number
- miniChartK: number
- For advanced mode: evsi?: number, cod?: number, netValue?: number

Layout (1080x1080 fixed size):
1. Header: Title (customizable) + mode badge (Basic/Advanced)
2. Verdict section: Large headline with formatted value
3. Key inputs grid: Prior summary, threshold summary
4. Mini chart: Scaled-down PriorDistributionChart (no interactivity needed for export)
5. Footer: "Created with Should I Test That?" (small, subtle)

Styling:
- Use existing design tokens (bg-card, text-foreground, etc.)
- White background for PNG consistency
- Inline all styles that might not render in html-to-image (use Tailwind classes that work)
- Fixed dimensions: 1080x1080px

Note: This component should be visually hidden in the DOM but rendered for html-to-image to capture.
  </action>
  <verify>Component file exists, exports ExportCard, TypeScript compiles</verify>
  <done>ExportCard renders composed export content at 1080x1080 with verdict, inputs, and mini chart placeholder</done>
</task>

<task type="auto">
  <name>Task 3: Create ExportButton with title input and integrate into results sections</name>
  <files>src/components/export/ExportButton.tsx, src/components/results/ResultsSection.tsx, src/components/results/AdvancedResultsSection.tsx</files>
  <action>
Create ExportButton component that:
1. Renders a text input for custom title (optional, placeholder "Add a title for your export...")
2. Renders "Export as PNG" button below the input
3. When clicked:
   - Shows loading state (isExporting from hook)
   - Calls exportPng with custom title or default
4. Contains the hidden ExportCard (rendered but visually hidden with sr-only or absolute positioning off-screen)
5. Connects ExportCard ref to useExportPng hook

Props received from parent:
- mode: 'basic' | 'advanced'
- evpiResults or evsiResults (depending on mode)
- sharedInputs (for prior/threshold display)
- prior distribution object for chart

Button styling:
- Secondary/outline variant to not compete with primary actions
- Icon: Download icon from lucide-react

Integrate ExportButton into ResultsSection:
- Add after the EVPI intuition block (at bottom of results)
- Pass mode='basic' and relevant results data

Integrate ExportButton into AdvancedResultsSection:
- Add after the EVSI intuition block (at bottom of results)
- Pass mode='advanced' and relevant results data
  </action>
  <verify>npm run build passes, ExportButton renders in both results sections</verify>
  <done>ExportButton with title input integrated into Basic and Advanced results, clicking triggers PNG download</done>
</task>

</tasks>

<verification>
1. `npm install` completes without errors
2. `npm run build` passes (TypeScript compiles)
3. `npm test` passes (no regressions)
4. Manual: Navigate to Basic mode results, export PNG works with custom title
5. Manual: Navigate to Advanced mode results, export PNG works
6. Exported PNG is 1080x1080, contains verdict, inputs, and mini chart
</verification>

<success_criteria>
- html-to-image installed and working
- ExportCard renders composed content at correct dimensions
- ExportButton appears in both Basic and Advanced results sections
- Custom title input works
- PNG download triggers on click with correct filename
- Exported image contains verdict, key inputs, and mini distribution chart
</success_criteria>

<output>
After completion, create `.planning/phases/06-export-polish/06-01-SUMMARY.md`
</output>
