---
phase: 05-advanced-mode
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/forms/PriorShapeForm.tsx
  - src/components/forms/UncertaintyPriorForm.tsx
  - src/lib/validation.ts
autonomous: true

must_haves:
  truths:
    - "User can select prior shape via radio cards (Normal, Student-t, Uniform)"
    - "Student-t shows df preset buttons when selected (df=3 Heavy, df=5 Moderate, df=10 Near-normal)"
    - "Prior shape selection persists in store"
    - "Main chart updates live on shape selection"
  artifacts:
    - path: "src/components/forms/PriorShapeForm.tsx"
      provides: "Prior shape selector component with radio cards"
      min_lines: 80
    - path: "src/lib/validation.ts"
      provides: "Zod schema for prior shape validation"
      contains: "priorShapeSchema"
  key_links:
    - from: "src/components/forms/PriorShapeForm.tsx"
      to: "src/stores/wizardStore.ts"
      via: "setAdvancedInput"
      pattern: "setAdvancedInput.*priorShape"
    - from: "src/components/forms/PriorShapeForm.tsx"
      to: "src/components/forms/inputs/RadioCard.tsx"
      via: "import"
      pattern: "import.*RadioCard"
---

<objective>
Create the prior shape selector UI for Advanced mode using radio cards pattern, with Student-t df presets.

Purpose: Allow users to select alternative prior shapes (Normal, Student-t, Uniform) per ADV-IN-01, ADV-IN-02, ADV-IN-10.
Output: PriorShapeForm component with radio cards, integrated with wizard store.
</objective>

<execution_context>
@/Users/ryan.lucht/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ryan.lucht/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-advanced-mode/05-CONTEXT.md
@.planning/phases/05-advanced-mode/05-RESEARCH.md
@src/components/forms/ThresholdScenarioForm.tsx (pattern reference for RadioCard usage)
@src/components/forms/inputs/RadioCard.tsx
@src/components/forms/UncertaintyPriorForm.tsx
@src/lib/validation.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add prior shape validation schema</name>
  <files>src/lib/validation.ts</files>
  <action>
    Add Zod schema for prior shape form:

    ```typescript
    /**
     * Prior shape selection schema (Advanced mode)
     * Validates prior distribution type and Student-t df when applicable
     */
    export const priorShapeSchema = z.discriminatedUnion('shape', [
      z.object({
        shape: z.literal('normal'),
      }),
      z.object({
        shape: z.literal('student-t'),
        df: z.union([z.literal(3), z.literal(5), z.literal(10)]),
      }),
      z.object({
        shape: z.literal('uniform'),
      }),
    ]);

    export type PriorShapeFormData = z.infer<typeof priorShapeSchema>;
    ```

    This handles the discriminated union pattern where df is only required for Student-t.
  </action>
  <verify>
    - `npm run typecheck` passes
    - Schema exports correctly
  </verify>
  <done>
    Prior shape validation schema added to validation.ts
  </done>
</task>

<task type="auto">
  <name>Task 2: Create PriorShapeForm component</name>
  <files>src/components/forms/PriorShapeForm.tsx</files>
  <action>
    Create PriorShapeForm.tsx following ThresholdScenarioForm pattern:

    1. Component structure:
       - forwardRef with PriorShapeFormHandle (validate method)
       - Uses react-hook-form with zodResolver
       - RadioCardGroup with 3 RadioCard options

    2. Radio cards layout:
       - **Normal (default)**:
         - Title: "Normal distribution"
         - Description: "Standard bell curve - a solid default for most experiments"
         - No additional inputs

       - **Student-t (fat-tailed)**:
         - Title: "Fat-tailed (Student-t)"
         - Description: "Heavy tails for when rare large effects are plausible"
         - When selected, show df preset buttons (ToggleGroup):
           - df=3: "Heavy tails"
           - df=5: "Moderate"
           - df=10: "Near-normal"
         - Helper text per ADV-IN-10: "Evidence suggests many experimentation programs' outcomes appear fat-tailed: most tests are small, but rare outcomes are much larger than a normal curve predicts."

       - **Uniform**:
         - Title: "Uniform (uninformed)"
         - Description: "Equal probability across the entire interval"
         - Warning helper per ADV-IN-10: "Uniform priors should rarely be used; pretending we know nothing is often misleading."

    3. Store integration:
       - On shape change, call setAdvancedInput('priorShape', shape)
       - On df change (Student-t), call setAdvancedInput('studentTDf', df)
       - When switching away from Student-t, clear studentTDf to null

    4. Mode context:
       - Only render this form when mode === 'advanced'
       - Per 05-CONTEXT.md: When switching Basic -> Advanced, default to 'normal' shape

    5. Styling:
       - Use same RadioCard/RadioCardGroup as ThresholdScenarioForm
       - df buttons use ToggleGroup (like unit toggle in threshold form)
       - Warning text for Uniform uses text-amber-600 or similar warning color
  </action>
  <verify>
    - Component renders without errors
    - Radio cards are clickable and update store
    - Student-t shows df buttons when selected
    - `npm run typecheck` passes
  </verify>
  <done>
    PriorShapeForm component created with radio cards for shape selection and Student-t df presets.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate PriorShapeForm with UncertaintyPriorForm</name>
  <files>src/components/forms/UncertaintyPriorForm.tsx</files>
  <action>
    Update UncertaintyPriorForm to conditionally show PriorShapeForm in Advanced mode:

    1. Import PriorShapeForm and useWizardStore mode selector

    2. At the top of the form (before interval inputs):
       - If mode === 'advanced', render PriorShapeForm
       - Add section divider between shape selector and interval inputs

    3. Update section intro copy for Advanced mode:
       - Basic: "How confident are you in your prediction?"
       - Advanced: "What shape describes your uncertainty? Then specify your 90% interval."

    4. For Uniform prior (Advanced mode):
       - The 90% interval inputs become the distribution bounds
       - Update helper text: "These bounds define the edges of your uniform distribution"
       - Interval still uses same inputs, just interpretation differs

    5. Ensure existing Basic mode behavior unchanged:
       - PriorShapeForm hidden in Basic mode
       - Default/Custom prior toggle still works
  </action>
  <verify>
    - In Basic mode, form looks unchanged
    - In Advanced mode, shape selector appears above interval inputs
    - Switching modes shows/hides shape selector
    - `npm test` passes (existing tests)
  </verify>
  <done>
    PriorShapeForm integrated into UncertaintyPriorForm, appearing only in Advanced mode.
  </done>
</task>

</tasks>

<verification>
Run validation:
```bash
npm run typecheck && npm test && npm run lint
```

Manual check:
1. Start dev server: `npm run dev`
2. Switch to Advanced mode from Welcome page
3. Navigate to Uncertainty section
4. Verify shape selector appears with 3 options
5. Select Student-t, verify df buttons appear
6. Verify store updates (React DevTools or console)
</verification>

<success_criteria>
- Prior shape selector renders in Advanced mode only
- Three radio card options: Normal, Student-t, Uniform
- Student-t shows df presets (3, 5, 10) when selected
- Helper text matches ADV-IN-10 requirements
- Store updates on selection
- All existing tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/05-advanced-mode/05-02-SUMMARY.md`
</output>
