---
phase: 06.1-calculation-bugs-polish
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/forms/UncertaintyPriorForm.tsx
  - src/components/forms/PriorShapeForm.tsx
  - src/components/forms/BaselineMetricsForm.tsx
  - src/components/forms/ExperimentDesignForm.tsx
  - src/components/results/AdvancedResultsSection.tsx
autonomous: true

must_haves:
  truths:
    - "Advanced mode has 'Fill with Recommended Default' button like Basic mode"
    - "Default prior button in Advanced mode includes Eppo attribution"
    - "Sigma display removed from Basic mode interval summary"
    - "Sigma display renamed to 'std dev' in Advanced mode"
    - "Redundant tooltips removed from Baseline Metrics form"
    - "Redundant tooltips removed from Experiment Design form"
    - "Decision latency has tooltip only, no helper text"
    - "Annual visitors helper text updated per spec"
    - "Uncertainty section helper text updated (normal distribution wording)"
    - "Derive from annual option moved inline with Daily eligible traffic title"
    - "Advanced results how-to-interpret uses 'imperfect information' wording"
  artifacts:
    - path: "src/components/forms/UncertaintyPriorForm.tsx"
      provides: "Updated helper text and sigma display logic"
    - path: "src/components/forms/PriorShapeForm.tsx"
      provides: "Default prior button with Eppo attribution"
    - path: "src/components/forms/BaselineMetricsForm.tsx"
      provides: "Updated helper text, removed redundant tooltips"
    - path: "src/components/forms/ExperimentDesignForm.tsx"
      provides: "Inline derive option, removed tooltips, decision latency tooltip only"
  key_links:
    - from: "src/components/forms/PriorShapeForm.tsx"
      to: "default prior button"
      via: "button onClick fills default values"
      pattern: "Fill with Recommended Default"
---

<objective>
Add default prior option to Advanced mode and update helper text/tooltips throughout the application.

Purpose: Advanced mode should have the same "Fill with Recommended Default" option as Basic mode. Additionally, various helper text and tooltip changes improve clarity and reduce redundancy.

Output: Updated forms with better UX polish and consistent default prior experience across modes.
</objective>

<execution_context>
@/Users/ryan.lucht/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ryan.lucht/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/forms/UncertaintyPriorForm.tsx
@src/components/forms/PriorShapeForm.tsx
@src/components/forms/BaselineMetricsForm.tsx
@src/components/forms/ExperimentDesignForm.tsx
@src/components/results/AdvancedResultsSection.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add default prior option to Advanced mode and update uncertainty text</name>
  <files>src/components/forms/UncertaintyPriorForm.tsx, src/components/forms/PriorShapeForm.tsx</files>
  <action>
1. In UncertaintyPriorForm.tsx:

a) Update the section intro text for both modes (around line 336-349):
```typescript
{/* Section intro - varies by mode */}
<div className="space-y-2">
  <div className="flex items-center gap-2">
    <p className="text-foreground font-medium">
      What do you think is a reasonable, but inclusive range of possible effect sizes from the idea you're testing?
    </p>
    <InfoTooltip content="A 'prior' is your belief about the effect before running a test. A wider range means more uncertainty." />
  </div>
  <p className="text-sm text-muted-foreground">
    A normal distribution is a solid first-pass model for effect sizes. Advanced mode can use other shapes.
  </p>
</div>
```

b) Update the "Fill with Recommended Default" button helper text (around line 385-393) to include Eppo attribution:
```typescript
<p className="text-xs text-muted-foreground mt-2">
  This is a reasonable starting point if you're unsure.
  It assumes most changes have small effects.
  This is also the prior used in Eppo for Bayesian experiment analysis.
</p>
```

c) Remove sigma display in Basic mode by updating the implied mean display (around line 588-592):
```typescript
{/* Only show sigma in Advanced mode, renamed to std dev */}
{priorParams && !isUniformPrior && mode === 'advanced' && (
  <span className="text-muted-foreground">
    (std dev: {(priorParams.sigma_L * 100).toFixed(2)}%)
  </span>
)}
```

2. In PriorShapeForm.tsx, add a "Fill with Recommended Default" button section BEFORE the radio cards (around line 260):

```typescript
{/* Default Prior Option - mirror of Basic mode */}
<div className="space-y-4 pb-4 border-b border-border/50">
  <button
    type="button"
    onClick={() => {
      // Fill with default prior values
      // This triggers the parent form's handleUseDefault equivalent
      // Need to access the parent's setSharedInput or use a callback
    }}
    className={cn(
      'w-full rounded-xl border-2 p-4 text-left transition-all',
      'hover:border-primary/50 hover:shadow-sm',
      'focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring',
      'border-border bg-card hover:bg-muted/50'
    )}
  >
    <div className="flex-1">
      <p className="font-medium text-foreground">
        Fill with Recommended Default
      </p>
      <p className="text-sm text-muted-foreground mt-1">
        I'm 90% sure the relative lift is between -8% and +8%
      </p>
      <p className="text-xs text-muted-foreground mt-2">
        This is a reasonable starting point if you're unsure.
        It assumes most changes have small effects.
        This is also the prior used in Eppo for Bayesian experiment analysis.
      </p>
    </div>
  </button>
</div>
```

To implement the default button in Advanced mode:
- Add an `onUseDefaultPrior` callback prop to PriorShapeForm
- Call this from the button onClick
- In UncertaintyPriorForm, pass handleUseDefault to PriorShapeForm
- When clicked in Advanced mode, it should also set the shape to 'normal' and clear studentTDf

Update PriorShapeForm props and implementation:
```typescript
interface PriorShapeFormProps {
  onUseDefaultPrior?: () => void;
}

export const PriorShapeForm = forwardRef<PriorShapeFormHandle, PriorShapeFormProps>(
  function PriorShapeForm({ onUseDefaultPrior }, ref) {
    // ...existing code...

    // In the button onClick:
    onClick={() => {
      // Reset to Normal shape
      handleShapeChange('normal');
      // Trigger parent's default prior fill
      onUseDefaultPrior?.();
    }}
```

In UncertaintyPriorForm, pass the callback:
```typescript
<PriorShapeForm ref={priorShapeFormRef} onUseDefaultPrior={handleUseDefault} />
```
  </action>
  <verify>Run `npm run dev`, test both Basic and Advanced mode uncertainty sections. Verify default button appears in both, sigma is hidden in Basic but shows as "std dev" in Advanced</verify>
  <done>Advanced mode has default prior button with Eppo attribution, sigma removed from Basic mode, renamed to std dev in Advanced</done>
</task>

<task type="auto">
  <name>Task 2: Update BaselineMetricsForm helper text and remove redundant tooltips</name>
  <files>src/components/forms/BaselineMetricsForm.tsx</files>
  <action>
1. Add helper text below section (need to add section header first). Add at the start of the form:
```typescript
<form className="space-y-6" onSubmit={(e) => e.preventDefault()}>
  {/* Section helper text */}
  <p className="text-sm text-muted-foreground">
    This will help us calculate the range of potential outcomes from the test in dollars.
  </p>

  {/* Baseline Conversion Rate */}
  ...
```

2. Remove tooltips from these fields by setting tooltip to undefined/removing the prop:

a) Baseline conversion rate - remove tooltip prop:
```typescript
<PercentageInput
  name="baselineConversionRate"
  label="Baseline conversion rate"
  placeholder="3.2%"
  helpText="This is your current conversion rate for the metric and audience/targeting you'd be testing. Ideally, choose a metric that is a revenue-generating event (e.g., visitors to signups)."
  // tooltip removed - redundant to helpText
  error={errors.baselineConversionRate?.message}
/>
```

b) Annual visitors - remove tooltip and update helper text:
```typescript
<NumberInput
  name="annualVisitors"
  label={`Annual ${unitLabel || 'visitors'}`}
  placeholder="1,000,000"
  helpText="Enter the number of visitors you expect in a year, based on the audience and triggering conditions of the test."
  // tooltip removed - redundant
  error={errors.annualVisitors?.message}
  unitLabelValue={unitLabel}
  onUnitLabelChange={handleUnitLabelChange}
/>
```

c) Value per conversion - remove tooltip:
```typescript
<CurrencyInput
  name="valuePerConversion"
  label="Value per conversion"
  placeholder="$50"
  helpText="Put the business value of one conversion in dollars. Examples: average order value, gross margin per purchase, first-year LTV, or a blended estimate. Pick one that matches how you evaluate impact."
  // tooltip removed - redundant
  error={errors.valuePerConversion?.message}
/>
```
  </action>
  <verify>Run `npm run dev`, verify Baseline Metrics section has helper text at top, no tooltip icons next to the three field labels</verify>
  <done>Baseline Metrics has section helper text, removed redundant tooltips from all three fields, updated annual visitors helper text</done>
</task>

<task type="auto">
  <name>Task 3: Update ExperimentDesignForm tooltips and derive option placement</name>
  <files>src/components/forms/ExperimentDesignForm.tsx</files>
  <action>
1. Remove tooltips from these fields (keep helpText where appropriate):

a) Test duration - remove tooltip:
```typescript
<NumberInput
  name="testDurationDays"
  label="How long will you run the test?"
  placeholder="14"
  helpText="Enter duration in days. Longer tests = more data = less noise."
  // tooltip removed
  error={errors.testDurationDays?.message}
  suffix="days"
/>
```

b) Daily traffic - remove tooltip, keep helpText:
```typescript
<NumberInput
  name="dailyTraffic"
  label="Daily eligible traffic"
  placeholder="5,000"
  helpText="Average daily visitors who can enter the experiment"
  // tooltip removed
  error={errors.dailyTraffic?.message}
/>
```

c) Variant allocation - remove tooltip:
```typescript
<PercentageInput
  name="trafficSplit"
  label="Variant allocation"
  placeholder="50%"
  helpText="Percentage of traffic seeing the variant (50% = standard A/B)"
  // tooltip removed
  error={errors.trafficSplit?.message}
/>
```

d) Eligible traffic - remove tooltip:
```typescript
<PercentageInput
  name="eligibilityFraction"
  label="Eligible traffic"
  placeholder="100%"
  helpText="What fraction of all traffic is eligible for this experiment?"
  // tooltip removed
  error={errors.eligibilityFraction?.message}
/>
```

2. Move "Derive from annual" option inline with the field label/title. Update the Daily traffic section:
```typescript
{/* Daily Traffic (required, with inline derive option) */}
<div className="space-y-2">
  <div className="flex items-center gap-2">
    <NumberInput
      name="dailyTraffic"
      label={
        <span className="flex items-center gap-2">
          Daily eligible traffic
          {canDeriveFromAnnual && (
            <button
              type="button"
              onClick={handleDeriveFromAnnual}
              className="text-xs text-primary hover:text-primary/80 font-normal"
            >
              (derive from annual: {Math.round(sharedInputs.annualVisitors! / 365).toLocaleString()}/day)
            </button>
          )}
        </span>
      }
      placeholder="5,000"
      helpText="Average daily visitors who can enter the experiment"
      error={errors.dailyTraffic?.message}
    />
  </div>
</div>
```

Note: The NumberInput component may need its label prop type updated to accept ReactNode. Check the component - if it only accepts string, wrap differently:
```typescript
<div className="space-y-2">
  <div className="flex items-center gap-2">
    <Label htmlFor="dailyTraffic">Daily eligible traffic</Label>
    {canDeriveFromAnnual && (
      <button
        type="button"
        onClick={handleDeriveFromAnnual}
        className="text-xs text-primary hover:text-primary/80"
      >
        (derive: {Math.round(sharedInputs.annualVisitors! / 365).toLocaleString()}/day)
      </button>
    )}
  </div>
  <NumberInput
    name="dailyTraffic"
    label="" // Empty or handle via custom rendering
    placeholder="5,000"
    helpText="Average daily visitors who can enter the experiment"
    error={errors.dailyTraffic?.message}
  />
</div>
```

3. Decision latency - remove helpText, keep only tooltip:
```typescript
<NumberInput
  name="decisionLatencyDays"
  label="Decision latency"
  placeholder="0"
  // helpText removed - tooltip only
  tooltip="Time needed for analysis, review, and deployment after the test concludes."
  error={errors.decisionLatencyDays?.message}
  suffix="days"
/>
```
  </action>
  <verify>Run `npm run dev`, verify: tooltips removed from test duration/daily traffic/variant allocation/eligible traffic, derive option is inline with label, decision latency has tooltip but no helper text</verify>
  <done>Removed redundant tooltips, moved derive option inline, decision latency uses tooltip only</done>
</task>

<task type="auto">
  <name>Task 4: Update Advanced results interpretation text</name>
  <files>src/components/results/AdvancedResultsSection.tsx</files>
  <action>
Update the "How to interpret" box text (around line 200-217) to use "imperfect information" wording:

```typescript
{/* EVSI Intuition */}
<div className="rounded-xl border bg-muted/30 border-muted p-4 space-y-2">
  <p className="text-sm font-medium text-foreground">
    How to interpret {formatSmartCurrency(Math.max(0, results.netValueDollars))}
  </p>
  <p className="text-sm text-muted-foreground">
    A/B tests infer the actual treatment effect of an idea based on sample information.
    In other words — they are imperfect information.
    The {formatSmartCurrency(results.evsi.evsiDollars)} EVSI represents
    the expected improvement in your decision from running this test.
    {results.cod.codApplies && (
      <>
        {' '}However, running the test delays the rollout, costing you{' '}
        {formatSmartCurrency(results.cod.codDollars)} in expected value.
      </>
    )}
    {' '}The net {formatSmartCurrency(Math.max(0, results.netValueDollars))} is
    the most you should pay to run this test.
  </p>
</div>
```

Key change: Replace "This test would give you imperfect information about whether your change helps." with "A/B tests infer the actual treatment effect of an idea based on sample information. In other words — they are imperfect information."
  </action>
  <verify>Run `npm run dev`, navigate to Advanced mode results, verify the interpretation text matches the new wording</verify>
  <done>Advanced results interpretation uses updated "imperfect information" wording</done>
</task>

</tasks>

<verification>
1. `npm run dev` - Application runs without errors
2. `npm run lint` - No lint errors
3. `npm run typecheck` - No type errors
4. Manual verification:
   - Basic mode: default prior button present, no sigma display
   - Advanced mode: default prior button present with Eppo text, sigma shows as "std dev"
   - Baseline section: helper text at top, no tooltip icons
   - Experiment Design: inline derive option, minimal tooltips, decision latency tooltip-only
   - Advanced results: updated interpretation text
</verification>

<success_criteria>
- Advanced mode has same default prior button as Basic mode with Eppo attribution
- Sigma hidden in Basic, renamed to "std dev" in Advanced
- Baseline Metrics has section helper text, no redundant tooltips
- Annual visitors helper text updated per spec
- Experiment Design tooltips removed, derive option inline
- Decision latency shows tooltip only (no helper text)
- Advanced results interpretation uses new wording
</success_criteria>

<output>
After completion, create `.planning/phases/06.1-calculation-bugs-polish/06.1-03-SUMMARY.md`
</output>
