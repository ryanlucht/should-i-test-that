---
phase: 06.1-calculation-bugs-polish
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/forms/UncertaintyPriorForm.tsx
  - src/components/forms/PriorShapeForm.tsx
autonomous: true

must_haves:
  truths:
    - "User sees 'Fill with Recommended Default' button in Advanced mode prior section"
    - "User sees Eppo attribution text below the default button"
    - "User does not see sigma value in Basic mode interval summary"
    - "User sees 'std dev' (not sigma) in Advanced mode interval summary"
  artifacts:
    - path: "src/components/forms/UncertaintyPriorForm.tsx"
      provides: "Updated sigma display logic for Basic vs Advanced"
    - path: "src/components/forms/PriorShapeForm.tsx"
      provides: "Default prior button with Eppo attribution"
  key_links:
    - from: "src/components/forms/PriorShapeForm.tsx"
      to: "default prior button"
      via: "button onClick fills default values"
      pattern: "Fill with Recommended Default"
---

<objective>
Add default prior option to Advanced mode and update sigma display labels.

Purpose: Advanced mode should have the same "Fill with Recommended Default" option as Basic mode, with Eppo attribution. Sigma display should be hidden in Basic mode and renamed to "std dev" in Advanced mode.

Output: PriorShapeForm with default button, UncertaintyPriorForm with updated sigma display logic.
</objective>

<execution_context>
@/Users/ryan.lucht/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ryan.lucht/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/forms/UncertaintyPriorForm.tsx
@src/components/forms/PriorShapeForm.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add default prior button to Advanced mode (PriorShapeForm)</name>
  <files>src/components/forms/PriorShapeForm.tsx</files>
  <action>
Add a "Fill with Recommended Default" button section BEFORE the radio cards in PriorShapeForm.tsx:

1. Add an `onUseDefaultPrior` callback prop to PriorShapeForm interface:
```typescript
interface PriorShapeFormProps {
  onUseDefaultPrior?: () => void;
}
```

2. Add the default prior button before the shape selection radio cards:
```typescript
{/* Default Prior Option - mirror of Basic mode */}
<div className="space-y-4 pb-4 border-b border-border/50">
  <button
    type="button"
    onClick={() => {
      // Reset to Normal shape
      handleShapeChange('normal');
      // Trigger parent's default prior fill
      onUseDefaultPrior?.();
    }}
    className={cn(
      'w-full rounded-xl border-2 p-4 text-left transition-all',
      'hover:border-primary/50 hover:shadow-sm',
      'focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring',
      'border-border bg-card hover:bg-muted/50'
    )}
  >
    <div className="flex-1">
      <p className="font-medium text-foreground">
        Fill with Recommended Default
      </p>
      <p className="text-sm text-muted-foreground mt-1">
        I'm 90% sure the relative lift is between -8% and +8%
      </p>
      <p className="text-xs text-muted-foreground mt-2">
        This is a reasonable starting point if you're unsure.
        It assumes most changes have small effects.
        This is also the prior used in Eppo for Bayesian experiment analysis.
      </p>
    </div>
  </button>
</div>
```
  </action>
  <verify>Run `npm run typecheck` - no type errors. Run `npm run lint` - no lint errors.</verify>
  <done>PriorShapeForm has default prior button with Eppo attribution text</done>
</task>

<task type="auto">
  <name>Task 2: Wire default button and update sigma display</name>
  <files>src/components/forms/UncertaintyPriorForm.tsx</files>
  <action>
1. Pass handleUseDefault to PriorShapeForm:
```typescript
<PriorShapeForm ref={priorShapeFormRef} onUseDefaultPrior={handleUseDefault} />
```

2. Update the sigma display in the implied mean section to:
   - Hide sigma completely in Basic mode
   - Rename to "std dev" in Advanced mode

Find the sigma display (around line 588-592) and update:
```typescript
{/* Only show sigma in Advanced mode, renamed to std dev */}
{priorParams && !isUniformPrior && mode === 'advanced' && (
  <span className="text-muted-foreground">
    (std dev: {(priorParams.sigma_L * 100).toFixed(2)}%)
  </span>
)}
```

Note: The component already has access to `mode` from context. Ensure the conditional checks `mode === 'advanced'` to hide in Basic mode.
  </action>
  <verify>Run `npm run dev`, verify: Advanced mode shows default button, clicking it fills values and sets shape to Normal. Basic mode interval summary has no sigma, Advanced mode shows "std dev"</verify>
  <done>Default button wired in Advanced mode, sigma hidden in Basic and renamed to std dev in Advanced</done>
</task>

</tasks>

<verification>
1. `npm run dev` - Application runs without errors
2. `npm run lint` - No lint errors
3. `npm run typecheck` - No type errors
4. Manual verification:
   - Basic mode: default prior button present (already exists), no sigma in interval display
   - Advanced mode: new default prior button present with Eppo text, sigma shows as "std dev"
</verification>

<success_criteria>
- Advanced mode has "Fill with Recommended Default" button matching Basic mode
- Eppo attribution text appears below the button
- Basic mode interval summary does not show sigma
- Advanced mode interval summary shows "std dev" instead of "sigma"
</success_criteria>

<output>
After completion, create `.planning/phases/06.1-calculation-bugs-polish/06.1-03-SUMMARY.md`
</output>
