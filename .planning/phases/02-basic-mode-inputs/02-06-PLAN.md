---
phase: 02-basic-mode-inputs
plan: 06
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/forms/BaselineMetricsForm.tsx
  - src/components/forms/UncertaintyPriorForm.tsx
  - src/components/forms/ThresholdScenarioForm.tsx
  - src/pages/CalculatorPage.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Validation errors only appear after blur, not while typing"
    - "Results summary shows correct default prior as '0% +/- 8%' not '0% +/- 5%'"
  artifacts:
    - path: "src/components/forms/BaselineMetricsForm.tsx"
      provides: "useForm with reValidateMode: 'onBlur'"
    - path: "src/components/forms/UncertaintyPriorForm.tsx"
      provides: "useForm with reValidateMode: 'onBlur'"
    - path: "src/components/forms/ThresholdScenarioForm.tsx"
      provides: "useForm with reValidateMode: 'onBlur'"
    - path: "src/pages/CalculatorPage.tsx"
      provides: "Default prior display uses DEFAULT_INTERVAL constant"
  key_links:
    - from: "useForm config"
      to: "validation timing"
      via: "reValidateMode: 'onBlur'"
      pattern: "reValidateMode:\\s*['\"]onBlur['\"]"
    - from: "CalculatorPage"
      to: "DEFAULT_INTERVAL"
      via: "import and template string"
      pattern: "DEFAULT_INTERVAL\\.high"
---

<objective>
Fix two minor UX issues:
1. Validation errors appearing while typing (should only appear on blur)
2. Results summary showing wrong default prior ("0% +/- 5%" should be "0% +/- 8%")

**UAT References:** Tests 11, 13
</objective>

<execution_context>
@/Users/ryan.lucht/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ryan.lucht/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-basic-mode-inputs/02-UAT.md
@src/components/forms/BaselineMetricsForm.tsx
@src/components/forms/UncertaintyPriorForm.tsx
@src/components/forms/ThresholdScenarioForm.tsx
@src/pages/CalculatorPage.tsx
@src/lib/prior.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add reValidateMode to all useForm configs</name>
  <files>src/components/forms/BaselineMetricsForm.tsx, src/components/forms/UncertaintyPriorForm.tsx, src/components/forms/ThresholdScenarioForm.tsx</files>
  <action>
**Root cause:** react-hook-form's default reValidateMode is 'onChange', so after the first validation error is shown (on blur), subsequent re-validation happens on every keystroke.

**Fix:** Add `reValidateMode: 'onBlur'` to all useForm configurations.

**BaselineMetricsForm.tsx (line 48):**
```typescript
const methods = useForm<BaselineMetricsFormData>({
  resolver: zodResolver(baselineMetricsSchema),
  mode: 'onBlur',
  reValidateMode: 'onBlur',  // ADD THIS LINE
  defaultValues: {
    // ... existing defaults
  },
});
```

**UncertaintyPriorForm.tsx (line 86):**
```typescript
const methods = useForm<PriorSelectionFormData>({
  resolver: zodResolver(priorSelectionSchema),
  mode: 'onBlur',
  reValidateMode: 'onBlur',  // ADD THIS LINE
  defaultValues: {
    // ... existing defaults
  },
});
```

**ThresholdScenarioForm.tsx (line 217):**
```typescript
const methods = useForm<ThresholdScenarioFormData>({
  resolver: zodResolver(thresholdScenarioSchema),
  mode: 'onBlur',
  reValidateMode: 'onBlur',  // ADD THIS LINE
  defaultValues: getDefaultValues(sharedInputs),
});
```
  </action>
  <verify>
Run `npm test` to ensure tests pass.
Manual test:
1. Enter invalid value in conversion rate (e.g., "abc")
2. Blur field - error appears
3. Focus field and start typing correction - error should NOT update until next blur
  </verify>
  <done>All forms only show/update validation errors on blur, not while typing.</done>
</task>

<task type="auto">
  <name>Task 2: Fix hardcoded default prior display in Results summary</name>
  <files>src/pages/CalculatorPage.tsx</files>
  <action>
**Root cause:** Line 350 has hardcoded string 'Default (0% +/- 5%)' instead of using the actual DEFAULT_INTERVAL constant.

**Fix:**

1. Add import at top of file (if not already present):
   ```typescript
   import { DEFAULT_INTERVAL } from '@/lib/prior';
   ```

2. Update line 350 from:
   ```typescript
   ? 'Default (0% +/- 5%)'
   ```

   To:
   ```typescript
   ? `Default (0% +/- ${Math.abs(DEFAULT_INTERVAL.high).toFixed(0)}%)`
   ```

   Or for more precision:
   ```typescript
   ? `Default (0% +/- ${Math.abs(DEFAULT_INTERVAL.high).toFixed(1)}%)`
   ```

   This will display "Default (0% +/- 8%)" or "Default (0% +/- 8.2%)" depending on precision choice.

   Note: The actual value is 8.22%, so showing "8%" is a reasonable rounded display. If exact match to form UI is desired, use `.toFixed(2)` for "8.22%".
  </action>
  <verify>
Run `npm test` to ensure tests pass.
Manual test:
1. Complete wizard with default prior selected
2. Results summary should show "Default (0% +/- 8%)" or "Default (0% +/- 8.22%)"
  </verify>
  <done>Results summary displays correct default prior interval matching the actual DEFAULT_INTERVAL constant.</done>
</task>

</tasks>

<verification>
1. `npm run lint` passes
2. `npm test` passes
3. Manual UAT re-test:
   - Test 11: Validation errors only appear on blur, not while typing
   - Test 13: Results summary shows "Default (0% +/- 8%)" for default prior
</verification>

<success_criteria>
- reValidateMode: 'onBlur' added to all three form components
- CalculatorPage uses DEFAULT_INTERVAL constant for display
- UAT Tests 11 and 13 pass
</success_criteria>

<output>
After completion, create `.planning/phases/02-basic-mode-inputs/02-06-SUMMARY.md`
</output>
