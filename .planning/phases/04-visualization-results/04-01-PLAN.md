---
phase: 04-visualization-results
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/calculations/chart-data.ts
  - src/lib/calculations/chart-data.test.ts
  - src/lib/calculations/index.ts
  - src/components/charts/PriorDistributionChart.tsx
  - src/components/charts/index.ts
  - package.json
autonomous: true

must_haves:
  truths:
    - "Distribution chart renders a smooth density curve from prior parameters"
    - "Chart X-axis shows lift percentage with proper formatting"
    - "Chart Y-axis is hidden per design spec"
    - "Chart is responsive and resizes with container"
  artifacts:
    - path: "src/lib/calculations/chart-data.ts"
      provides: "generateDensityCurveData, getDensityAtLift functions"
      exports: ["generateDensityCurveData", "getDensityAtLift", "ChartDataPoint"]
    - path: "src/components/charts/PriorDistributionChart.tsx"
      provides: "Base distribution chart component with gradient fill"
      exports: ["PriorDistributionChart"]
  key_links:
    - from: "src/components/charts/PriorDistributionChart.tsx"
      to: "src/lib/calculations/chart-data.ts"
      via: "Import generateDensityCurveData"
      pattern: "generateDensityCurveData"
    - from: "src/lib/calculations/chart-data.ts"
      to: "src/lib/calculations/statistics.ts"
      via: "Import standardNormalPDF"
      pattern: "standardNormalPDF"
---

<objective>
Create the foundational chart infrastructure: density curve data generation and base Recharts component with gradient fill.

Purpose: Establish the charting foundation that will be extended with overlays in plan 04-02. Per 04-CONTEXT.md, the chart visualizes the user's prior uncertainty with a Datadog-style smooth density curve.

Output: Chart data utilities with tests, base PriorDistributionChart component that renders a purple gradient-filled density curve with proper axis formatting.
</objective>

<execution_context>
@/Users/ryan.lucht/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ryan.lucht/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-visualization-results/04-CONTEXT.md
@.planning/phases/04-visualization-results/04-RESEARCH.md
@src/lib/calculations/statistics.ts
@src/lib/formatting.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Recharts and create chart data utilities</name>
  <files>
    - package.json
    - src/lib/calculations/chart-data.ts
    - src/lib/calculations/chart-data.test.ts
    - src/lib/calculations/index.ts
  </files>
  <action>
1. Install recharts: `npm install recharts`

2. Create `src/lib/calculations/chart-data.ts` with:
   - `ChartDataPoint` interface: `{ liftPercent: number; density: number }`
   - `generateDensityCurveData(mu_L: number, sigma_L: number, numPoints = 100)`:
     - Generate points from mu_L - 4*sigma_L to mu_L + 4*sigma_L (covers 99.99%)
     - For each point: compute z = (lift - mu_L) / sigma_L, density = standardNormalPDF(z) / sigma_L
     - Return array of `{ liftPercent: lift * 100, density }`
     - Handle edge case: if sigma_L < 0.0001, return spike at mean
   - `getDensityAtLift(lift_L: number, mu_L: number, sigma_L: number)`:
     - Compute density at a specific lift value (for mean marker positioning)
   - Add comments explaining the math per CLAUDE.md

3. Create `src/lib/calculations/chart-data.test.ts` with tests:
   - `generateDensityCurveData` returns 100 points by default
   - Points cover correct range (mu +/- 4 sigma)
   - Density is maximum at mean
   - liftPercent is in percentage form (not decimal)
   - Edge case: very small sigma returns spike at mean
   - `getDensityAtLift` returns correct density at mean

4. Update `src/lib/calculations/index.ts` to export new functions
  </action>
  <verify>
    - `npm run lint` passes
    - `npm test src/lib/calculations/chart-data.test.ts` passes
  </verify>
  <done>
    - Chart data generation functions work correctly with proper edge case handling
    - All tests pass
  </done>
</task>

<task type="auto">
  <name>Task 2: Create base PriorDistributionChart component</name>
  <files>
    - src/components/charts/PriorDistributionChart.tsx
    - src/components/charts/index.ts
  </files>
  <action>
1. Create `src/components/charts/PriorDistributionChart.tsx`:
   - Props interface:
     ```typescript
     interface PriorDistributionChartProps {
       mu_L: number;      // Prior mean (decimal)
       sigma_L: number;   // Prior standard deviation (decimal)
     }
     ```
   - Use `useMemo` to generate chart data from props (per pitfall #1 in RESEARCH.md)
   - Implement Recharts AreaChart:
     - ResponsiveContainer with width="100%" height={200}
     - defs with linearGradient "densityGradient": #7C3AED from 60% opacity to 10%
     - XAxis with:
       - dataKey="liftPercent"
       - type="number"
       - domain={['dataMin', 'dataMax']}
       - tickFormatter showing sign and % (e.g., "+5%", "-3%")
       - stroke="#6B7280" (text-muted-foreground)
       - fontSize={12}
     - YAxis: hide={true} (per 04-CONTEXT.md)
     - Area with:
       - type="monotone" (smooth curve)
       - dataKey="density"
       - stroke="#7C3AED" strokeWidth={2}
       - fill="url(#densityGradient)"
       - isAnimationActive={false} (per RESEARCH.md for live updates)
   - Add margin={{ top: 20, right: 20, bottom: 20, left: 20 }}

2. Create `src/components/charts/index.ts` barrel export

3. Styling notes:
   - Per 04-CONTEXT.md: Purple accent (#7C3AED), gradient fill, hidden Y-axis
   - Per DESIGN-03: Charts match UI styling
  </action>
  <verify>
    - `npm run lint` passes
    - `npm run build` passes (TypeScript compiles)
    - Chart can be imported and rendered in a test harness
  </verify>
  <done>
    - PriorDistributionChart renders a smooth purple density curve
    - X-axis shows lift percentages with proper formatting
    - Y-axis is hidden
    - Chart is responsive
  </done>
</task>

<task type="auto">
  <name>Task 3: Add formatting utility for lift percentages</name>
  <files>
    - src/lib/formatting.ts
  </files>
  <action>
1. Add to `src/lib/formatting.ts`:
   ```typescript
   /**
    * Format lift percentage for chart axis/tooltip display
    *
    * Examples:
    * - formatLiftPercent(5.0) => "+5%"
    * - formatLiftPercent(-2.5) => "-3%" (rounded)
    * - formatLiftPercent(0) => "0%"
    */
   export function formatLiftPercent(value: number): string {
     const rounded = Math.round(value);
     const sign = rounded > 0 ? '+' : '';
     return `${sign}${rounded}%`;
   }
   ```

2. This function is used by the chart's XAxis tickFormatter
  </action>
  <verify>
    - `npm run lint` passes
    - `npm run build` passes
  </verify>
  <done>
    - formatLiftPercent utility function exists and correctly formats lift values
  </done>
</task>

</tasks>

<verification>
After all tasks:
1. `npm run lint` - no lint errors
2. `npm test` - all tests pass including new chart-data tests
3. `npm run build` - TypeScript compiles without errors
4. Manual: Import PriorDistributionChart and render with test data to verify visual appearance
</verification>

<success_criteria>
- Recharts installed and available
- generateDensityCurveData produces correct density curve data points
- getDensityAtLift returns correct density at any lift value
- PriorDistributionChart renders smooth purple density curve
- X-axis shows lift percentages, Y-axis hidden
- Chart uses ResponsiveContainer for responsive sizing
- All tests pass, no lint errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-visualization-results/04-01-SUMMARY.md`
</output>
